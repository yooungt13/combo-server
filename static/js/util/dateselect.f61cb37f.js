define(["lib/zepto.js","util/msg.js","lib/iscroll.js"],function(e,a){function t(t){function c(){var e={};return e.year=p.eq(Math.abs(u.y)/b).data("value"),e.month=f.eq(Math.abs(m.y)/b).data("value"),e.day=y.eq(Math.abs(h.y)/b).data("value"),e}function n(a){var t=v.options.maxDate;if(f.removeClass("disabled"),y.removeClass("disabled"),t.getFullYear()==a.year){var o=t.getMonth()+1;f.each(function(){var a=e(this);a.data("value")>o&&a.addClass("disabled")})}var r=l(a.year,a.month);return t.getFullYear()==a.year&&t.getMonth()+1==a.month&&(r=t.getDate()),y.each(function(){var a=e(this);a.data("value")>r&&a.addClass("disabled")}),t.getFullYear()==a.year&&(o=t.getMonth()+1,a.month>o)?void m.scrollToElement(f.eq(o-1)[0]):void(a.day>r&&h.scrollToElement(y.eq(r-1)[0]))}function i(a){p.each(function(){var t=e(this);return t.data("value")==a?(u.scrollToElement(this),!1):void 0})}function s(a){f.each(function(){var t=e(this);return t.data("value")==a?(m.scrollToElement(this),!1):void 0})}function d(a){y.each(function(){var t=e(this);return t.data("value")==a?(h.scrollToElement(this),!1):void 0})}var v=this;this.options=e.extend({},r,t),a.diy(o,{type:"dateselect",closeOut:!0,closeFun:function(){a._el.animate({translateY:"100%"},200,"ease-in"),a._el_bg.fadeOut(200),setTimeout(function(){a._el.remove(),a._el_bg.remove()},300)}}),this.initDateHtml();var u=new IScroll("#com-date-wrapper-year",{snap:!0,hScroll:!1,vScrollbar:!1,bounce:!1,bounceLock:!0}),m=new IScroll("#com-date-wrapper-month",{snap:!0,hScroll:!1,vScrollbar:!1,bounce:!1,bounceLock:!0}),h=new IScroll("#com-date-wrapper-day",{snap:!0,hScroll:!1,vScrollbar:!1,bounce:!1,bounceLock:!0}),p=e("#com-date-wrapper-year li"),f=e("#com-date-wrapper-month li"),y=e("#com-date-wrapper-day li"),b=y.eq(0).height();u.on("scrollEnd",function(){var e=c();n(e)}),m.on("scrollEnd",function(){var e=c();n(e)}),h.on("scrollEnd",function(){var e=c();n(e)});var w=this.options.initDate;w&&(i(w.getFullYear()),s(w.getMonth()+1),d(w.getDate())),a._el.on("click",".op-cancel",function(){a.close()}),a._el.on("click",".op-ok",function(){var e=c();v.options.onselect&&v.options.onselect(new Date(e.year,e.month-1,e.day)),a.close()})}function l(e,a){return new Date(e,a,0).getDate()}var o='<div class="com-date">            <div class="hd">                <div class="op-cancel">取消</div>                <div class="op-ok">完成</div>            </div>            <div class="bd">                <div class="bg-top"></div>                <div class="wrapper-date">                    <div id="com-date-wrapper-year" class="scroller-wrapper">                        <ul class="scroller scroller-year" id="com-date-scroller-year">                        </ul>                    </div>                    <div id="com-date-wrapper-month" class="scroller-wrapper">                        <ul class="scroller" id="com-date-scroller-month">                        </ul>                    </div>                    <div id="com-date-wrapper-day" class="scroller-wrapper">                        <ul class="scroller scroller-day" id="com-date-scroller-day">                        </ul>                    </div>                </div>                <div class="bg-bottom"></div>            </div>        </div>',r={minDate:new Date(1999,0,1),maxDate:new Date};return t.prototype.initDateHtml=function(){var a,t=this.options.minDate.getFullYear(),l=this.options.maxDate.getFullYear(),o=1,r=12,c=1,n=31,i="";for(a=t;l+1>a;a++)i+='<li class="item" data-value='+a+">"+a+"年</li>";var s="";for(a=o;r+1>a;a++)s+='<li class="item" data-value='+a+">"+a+"月</li>";var d="";for(a=c;n+1>a;a++)d+='<li class="item" data-value='+a+">"+a+"日</li>";e("#com-date-scroller-year").html(i),e("#com-date-scroller-month").html(s),e("#com-date-scroller-day").html(d)},t});